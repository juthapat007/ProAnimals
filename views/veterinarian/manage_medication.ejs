<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤</title>
  
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/output.css">
  <!-- Bootstrap CSS + JS (bundle ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ collapse ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap">
      
  <style>
    /* =========================
   üì± Responsive
   ========================= */
@media (max-width: 768px) {
  .pet-card {
    flex-direction: column;
  }

  .pet-row {
    grid-template-columns: 1fr 1fr; /* ‡πÅ‡∏Ñ‡πà label-value */
  }

  .pet-row strong {
    text-align: right;
  }

  .pet-actions {
    flex-direction: column;
    align-items: stretch;
  }

  .btn {
    width: 100%;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .pet-row {
    grid-template-columns: 1fr; /* ‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß */
  }

  .pet-row strong {
    text-align: left;
  }
}
  </style>
</head>
<body>

<div class="container">
  <%- include('../partials/header_vet') %>

      <h3><i class="fas fa-pills mr-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤</h3>
      <span class="text-sm">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <%= vetName %></span>

    <!-- Search -->
    <div class="flex flex-col md:flex-row justify-between items-center gap-3 my-6">
      <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤..." onkeypress="handleKeyPress(event)"
        class="w-full md:w-1/3 border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
      <button type="button" onclick="searchDrug()" 
        class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg shadow transition flex items-center">
        <i class="fas fa-search mr-2"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      </button>
      <button type="button" onclick="clearSearch()" 
        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded-lg shadow transition flex items-center">
        <i class="fas fa-times mr-2"></i> ‡∏•‡πâ‡∏≤‡∏á
      </button>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏≤ -->
    <form id="medForm" action="/veterinarian/manage_medication/add" method="POST" class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-6 p-4 bg-blue-50 rounded-lg fade-in">
      <input type="text" id="medication_id" name="medication_id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤" required 
        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 w-full">
      <input type="text" id="medicine_name" name="medicine_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤" required 
        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 w-full">
      <input type="number" id="stock_quantity" name="stock_quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" required 
        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 w-full">
      <input type="text" id="medicine_package" name="medicine_package" placeholder="‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå" required 
        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 w-full">
      <input type="number" step="0.01" id="medicine_price" name="medicine_price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required 
        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 w-full">

      <div style="display: flex; justify-content: flex-end;" >
        <button type="submit" id="submitBtn"
          class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg shadow transition flex items-center">
          <i class="fas fa-plus-circle mr-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤
        </button>
        <button type="button" onclick="resetForm()" 
          class="bg-gray-400 hover:bg-gray-500 text-white font-semibold px-6 py-2 rounded-lg shadow transition flex items-center">
          <i class="fas fa-times mr-2"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
      </div>
    </form>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≤ -->
    <div class="overflow-x-auto rounded-lg shadow">
      <table class="w-full border border-gray-200">
        <thead class="bg-green-600 text-white">
          <tr>
            <th class="py-3 px-4 text-left">‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤</th>
            <th class="py-3 px-4 text-left">‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="py-3 px-4 text-left">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th class="py-3 px-4 text-left">‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
            <th class="py-3 px-4 text-left">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
            <th class="py-3 px-4 text-center">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="medTableBody">
          <% medications.forEach(m => { %>
          <tr id="row-<%= m.medication_id %>" 
              onclick="fillForm('<%= m.medication_id %>', '<%= m.medicine_name %>', '<%= m.stock_quantity %>', '<%= m.medicine_package %>', '<%= m.medicine_price %>')" 
              class="cursor-pointer odd:bg-white even:bg-gray-50 hover:bg-blue-50 transition">
            <td class="py-3 px-4"><%= m.medication_id %></td>
            <td class="py-3 px-4 medicine-name"><%= m.medicine_name %></td>
            <td class="py-3 px-4"><%= m.stock_quantity %></td>
            <td class="py-3 px-4"><%= m.medicine_package %></td>
            <td class="py-3 px-4"><%= m.medicine_price %></td>
            <td class="py-3 px-4 flex gap-2 justify-center">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö -->
              <form action="/veterinarian/manage_medication/delete" method="POST" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏¢‡∏≤ <%= m.medicine_name %>?')">
                <input type="hidden" name="medication_id" value="<%= m.medication_id %>">
                <button type="submit" 
                  class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded shadow transition flex items-center">
                  <i class="fas fa-trash-alt mr-1"></i> ‡∏•‡∏ö
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <div id="noResults" class="hidden mt-4 p-4 bg-yellow-100 text-yellow-800 rounded-lg text-center">
      <i class="fas fa-exclamation-triangle mr-2"></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    </div>

    <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
    <% if (typeof alertMessage !== 'undefined' && alertMessage) { %>
      <div id="alertBox" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg fade-in">
        <div class="flex items-center">
          <i class="fas fa-check-circle mr-2"></i>
          <span><%= alertMessage %></span>
        </div>
      </div>
      <script>
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setTimeout(() => {
          const alertBox = document.getElementById('alertBox');
          if (alertBox) alertBox.classList.add('hidden');
        }, 3000);
      </script>
    <% } %>

  </div>

  <script>
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠
    function searchDrug() {
      const keyword = document.getElementById("searchInput").value.toLowerCase().trim();
      const rows = document.querySelectorAll('#medTableBody tr');
      let found = false;
      
      // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      rows.forEach(row => {
        const medicineName = row.querySelector('.medicine-name').textContent.toLowerCase();
        if (medicineName.includes(keyword)) {
          row.classList.remove('hidden-row');
          found = true;
        } else {
          row.classList.add('hidden-row');
        }
      });
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      const noResults = document.getElementById('noResults');
      if (!found && keyword !== '') {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
      }
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      resetForm();
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function clearSearch() {
      document.getElementById("searchInput").value = '';
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß
      const rows = document.querySelectorAll('#medTableBody tr');
      rows.forEach(row => {
        row.classList.remove('hidden-row');
      });
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      document.getElementById('noResults').classList.add('hidden');
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        searchDrug();
        event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÅ‡∏ñ‡∏ß
    function fillForm(id, name, qty, pkg, price) {
      document.getElementById("medication_id").value = id;
      document.getElementById("medicine_name").value = name;
      document.getElementById("stock_quantity").value = qty;
      document.getElementById("medicine_package").value = pkg;
      document.getElementById("medicine_price").value = price;

      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      document.getElementById("medForm").action = "/veterinarian/manage_medication/update";
      const submitBtn = document.getElementById("submitBtn");
      submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i> ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≤';
      submitBtn.classList.remove("bg-green-600", "hover:bg-green-700");
      submitBtn.classList.add("bg-blue-600", "hover:bg-blue-700");
      
      // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      document.querySelectorAll('tr[id^="row-"]').forEach(row => {
        row.classList.remove('highlight');
      });
      document.getElementById(`row-${id}`).classList.add('highlight');
    }

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤
    function resetForm() {
      document.getElementById("medForm").reset();
      document.getElementById("medForm").action = "/veterinarian/manage_medication/add";
      const submitBtn = document.getElementById("submitBtn");
      submitBtn.innerHTML = '<i class="fas fa-plus-circle mr-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤';
      submitBtn.classList.remove("bg-blue-600", "hover:bg-blue-700");
      submitBtn.classList.add("bg-green-600", "hover:bg-green-700");
      
      // ‡∏•‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß
      document.querySelectorAll('tr[id^="row-"]').forEach(row => {
        row.classList.remove('highlight');
      });
    }
  </script>

</body>
</html>