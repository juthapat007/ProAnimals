<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
  <%- include('../partials/link') %>
</head>
<body>
<div class="container ">
  
  <!-- Header -->
  <%- include('../partials/header_vet') %>
 <p class="text-sm text-gray mt-2">
  ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠: <span class="font-semibold"><%= vetId %></span>
</p>

<div class="container border-2 border-gray-200 flex flex-col md:flex-row md:justify-between md:items-center gap-6 mt-4">
  
  <!-- ‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô -->
  <div class="flex items-center gap-2">
    <i class="fas fa-paw text-2xl text-primary2"></i>
    <h2 class="text-xl font-bold text-text">
      ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    </h2>
  </div>
  
  <!-- Date Filter -->
  <div class="flex items-center gap-4">

    <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà :</p>
  <form method="get" action="/veterinarian/pet_order" class="flex items-center gap-3">

    <input 
      type="text" 
      id="SelectDate" 
      name="date"
      value="<%= selectedDate %>"
      class="form-input "
      placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà..."
    >
  </form>
</div>




</div>
<br>

  <!-- Booking Cards -->
  <% if (bookings && bookings.length > 0) { %>
    <div class="grid gap-6">
      <% bookings.forEach((pet) => { %>
        <div class="flex gap-4 bg-white border-2 border-gray-200 rounded-xl shadow-custom p-4 hover:shadow-lg transition">
          
          <!-- Pet Image -->
          <div class="w-40 flex flex-col items-center">
            <span class="text-sm text-gray-500 mb-2">ID ‡πÄ‡∏Ñ‡∏™ : <%= pet.booking_id %></span>
            <img 
              src="<%= pet.pet_image ? '/uploads/' + pet.pet_image : '/images/no-pet.png' %>" 
              alt="pet"
              class="w-32 h-32 object-cover rounded-lg border"
            >
          </div>

          <!-- Pet Info -->
          <div class="flex-1 space-y-3">
            <div class="grid grid-cols-2 gap-2 text-sm">
              <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:</strong> <%= pet.pet_name %></p>
              <p><strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</strong> <%= pet.service_name %></p>
              <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</strong> <%= pet.owner_name %></p>
              <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:</strong> <%= pet.pet_type_name %></p>
              <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> <%= pet.customer_type %></p>
              <div class="flex items-center gap-2">
                <label for="status<%= pet.booking_id %>" class="font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</label>
                <select 
                  id="status<%= pet.booking_id %>" 
                  class="border border-gray-300 rounded-lg px-2 py-1 focus:ring-2 focus:ring-primary text-sm"
                >
                  <% ['‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤','‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô','‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'].forEach(st => { %>
                    <option value="<%= st %>" <%= pet.status === st ? 'selected' : '' %>>
                      <%= st %>
                    </option>
                  <% }) %>
                </select>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end gap-2">
             <button 
                type="button" 
                class="px-4 py-2 bg-warning text-white text-sm rounded-lg hover: bg-edit transition"
                onclick="updateStatus(<%= pet.booking_id %>, document.getElementById('status<%= pet.booking_id %>').value)">
                ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
              </button>
              <button 
                type="button" 
                class="px-4 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition"
                onclick="goToHistory(<%= pet.booking_id %>)">
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
              </button>
              
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="text-center py-12 text-gray-500 text-lg">
      üéâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ
    </div>
  <% } %>

</div>
<script src="/js/calendar_select.js" defer></script>
<script>
  
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
async function goToHistory(bookingId) {
    try {
        const response = await fetch('/veterinarian/pet_order/setBookingId', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ bookingId })
});


        const result = await response.json();
        if (result.success) {
            window.location.href = '/veterinarian/mg_history';
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ');
    }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
async function updateStatus(bookingId, status) {
    try {
        const response = await fetch(`/veterinarian/pet_order/booking/${bookingId}/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            location.reload();
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞');
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
function goHome() {
    window.location.href = '/veterinarian/pet_order';
}

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
// function toggleMenu() {
//     const menu = document.getElementById('menuDropdown');
//     menu.style.display = menu.style.display === 'none' || menu.style.display === '' ? 'block' : 'none';
// }

// // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
// document.addEventListener('click', function(event) {
//     const menu = document.getElementById('menuDropdown');
//     const menuIcon = document.querySelector('.icon-menu');
    
//     if (!menuIcon.contains(event.target)) {
//         menu.style.display = 'none';
//     }
// });
</script>
</body>
</html>