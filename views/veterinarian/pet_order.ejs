<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
  <%- include('../partials/link') %>


</head>
<body>
<div class="container">
  <%- include('../partials/header_vet') %>
  <p>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠: <%= vetId %></p>


  
  <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
  
  <!-- Date Filter -->
  <div class="filter-date" style="display: flex;" >
    <form method="get" action="/veterinarian/pet_order" >
      <span for="SelectDate">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: </span>
      <input 
        class="date-input-wrapper" 
        type="date" 
        id="SelectDate" 
        name="date"
        value="<%= selectedDate %>"
        onchange="this.form.submit()" 
      >
    </form>
  </div>

  <!-- Booking Cards -->
  <% if (bookings && bookings.length > 0) { %>
    <% bookings.forEach((pet) => { %>
      <div  style="display: flex;">
        <div class="pet-id">ID ‡πÄ‡∏Ñ‡∏™ : <%= pet.booking_id %>
              <img src="<%= pet.pet_image ? '/uploads/' + pet.pet_image : '/images/no-pet.png' %>" class="image-preview" alt="pet"></div>

    <div class="pet-card" >
      <div class="pet-info">
          <div class="pet-row" >
            <strong style="padding-left: 33px;">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á :</strong>
            <span><%= pet.pet_name %></span>
            <strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ :</strong>
            <span><%= pet.service_name %></span>
          </div>
            
          <div class="pet-row">
            <strong style="padding-left: 48px;">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á :</strong>
            <span><%= pet.owner_name %></span>
            <strong >‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á :</strong>
            <span><%= pet.pet_type_name %></span>
          </div>

          <div class="pet-row">
            <strong style="padding-left: 30px;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ :</strong>
            <span><%= pet.customer_type %></span>

  <strong for="status<%= pet.booking_id %>">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ :</strong>
  <select name="status" id="status<%= pet.booking_id %>">
    <% ['‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤','‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô','‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'].forEach(st => { %>
      <option value="<%= st %>" <%= pet.status === st ? 'selected' : '' %>>
        <%= st %>
      </option>
    <% }) %>
  </select>
          </div>

          <div style="display: flex; justify-content: flex-end;" >
            <button type="button" class="btn btn-info" onclick="goToHistory(<%= pet.booking_id %>)">
  ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
</button>
            <div style="padding-left: 5px;"></div>
            <button type="button" class="btn btn-edit" onclick="updateStatus(<%= pet.booking_id %>, document.getElementById('status<%= pet.booking_id %>').value)">
              ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            </button>
          </div>
        </div>
      </div>
      </div>

    <% }) %>
<% } else { %>
    <div style="text-align:center; padding:30px; color:#999;">üéâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>
<% } %>
</div>

<script>
  
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
async function goToHistory(bookingId) {
    try {
        const response = await fetch('/veterinarian/pet_order/setBookingId', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ bookingId })
});


        const result = await response.json();
        if (result.success) {
            window.location.href = '/veterinarian/mg_history';
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ');
    }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
async function updateStatus(bookingId, status) {
    try {
        const response = await fetch(`/veterinarian/pet_order/booking/${bookingId}/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            location.reload();
        } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞');
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
function goHome() {
    window.location.href = '/veterinarian/pet_order';
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
function toggleMenu() {
    const menu = document.getElementById('menuDropdown');
    menu.style.display = menu.style.display === 'none' || menu.style.display === '' ? 'block' : 'none';
}

// ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
document.addEventListener('click', function(event) {
    const menu = document.getElementById('menuDropdown');
    const menuIcon = document.querySelector('.icon-menu');
    
    if (!menuIcon.contains(event.target)) {
        menu.style.display = 'none';
    }
});
</script>
</body>
</html>