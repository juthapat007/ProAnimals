<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ | ‡πÑ‡∏ä‡∏¢‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå</title>

  <%- include('../partials/link') %>

 </head>
<body class="">
<div class="container">

  <!-- Header -->
  <%- include('../partials/header') %>
  <%- include('../partials/numberBar', { step: 2 }) %>

  <!-- ‡πÅ‡∏™‡∏î‡∏á error ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ pet -->
  <% if (!(locals.pet && locals.pet_id)) { %>
    <div class="error-message bg-red-50 border border-red-400 text-red p-4 rounded-lg text-center my-5">
      <i class="fas fa-exclamation-triangle mr-2"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡πà‡∏≠‡∏ô
      <br><br>
      <a href="/users/select_pet" class="btn btn-primary inline-block">
        <i class="fas fa-arrow-left mr-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
      </a>
    </div>
  <% } %>

  <h2 class="text-xl font-bold text-text mt-5 mb-3">
    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ <span class="text-red">*</span>
  </h2>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ -->
  <form id="bookingForm" method="POST" action="/users/confirm" class="space-y-6">
    <input type="hidden" name="pet_id" value="<%= pet_id %>">
    <input type="hidden" name="cus_id" value="<%= cus_id %>">
<input type="hidden" name="time" id="selectedTime">

    <input type="hidden" id="selectedDateTime" name="datetime" value="">
    <input type="hidden" id="selectedVetId" name="vet_id" value="">

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[500px] overflow-y-auto p-2  rounded-xl">
      <% services.forEach(s => { %>
        <label class="service-card flex flex-col p-4 border-2 rounded-lg cursor-pointer hover:bg-light-pink transition">

          <div style="display: flex;">
          <input type="radio" name="service_id" value="<%= s.service_id %>" class="mb-2" onchange="updateService()"><div style="padding-right: 3%;"></div>
          <span class="text-lg font-bold text-primary2"><%= s.service_type %></span><div style="padding: 1%;"></div>
          <span class="text-text mt-1"><%= s.service_price.toLocaleString() %> ‡∏ö‡∏≤‡∏ó</span>
          </div>
        </label>
      <% }) %>
    </div>

  

<!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
<div class="flex items-center gap-1 mt-4 mb-2">
  <strong class="text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</strong><span class="text-red">*</span>
</div>
<div class="relative">
  <input 
    type="date" 
    id="SelectDate" 
    name="date"
    class="form-input border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:ring-2 focus:ring-primary focus:outline-none"
  />
  <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-primary2 text-lg cursor-pointer">
    <i class="fas fa-calendar-alt"></i>
  </span>
</div>
<div id="loadingMessage" class="text-sm text-gray my-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£...</div>
<div id="errorMessage" class="text-red-500 text-sm my-2 hidden"></div>

<!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
<div id="instructionMessage" class="text-sm text-blue-600 my-2">
  üìå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á -->
<div id="timeSelectionSection" class="hidden mt-4">
  <div class="flex items-center gap-1 mb-2">
    <strong class="text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</strong><span class="text-red">*</span>
  </div>
  <button type="button" 
          id="showTimeBtn"
          onclick="showAvailableTimes()" 
          class="w-full px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
    <i class="fas fa-clock"></i>
    ‡∏î‡∏π‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á
  </button>
  
  <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
  <div id="selectedTimeDisplay" class="hidden mt-3 p-3 bg-green-50 border border-green-200 rounded-lg">
    <i class="fas fa-check-circle text-green-600 mr-2"></i>
    <span class="text-green-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <span id="selectedTimeText">-</span></span>
  </div>
</div>

<!-- Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ -->
<div id="timeModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
  <div class="bg-white w-full max-w-md rounded-lg p-6 shadow-lg">
    <h3 class="text-lg font-bold mb-3 flex items-center gap-2">
      <i class="fas fa-clock text-primary"></i>
      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
    </h3>
    
    <!-- Loading state -->
    <div id="timeModalLoading" class="text-center py-8 hidden">
      <i class="fas fa-spinner fa-spin text-2xl text-primary mb-2"></i>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á...</p>
    </div>
    
    <!-- container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ -->
    <div id="timeSlotsContainer" class="grid grid-cols-2 gap-3 max-h-64 overflow-y-auto"></div>

    <!-- ‡∏õ‡∏∏‡πà‡∏° action -->
    <div class="flex justify-end gap-2 mt-6">
      <button type="button" onclick="closeTimeModal()" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition-colors">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
    </div>
  </div>
</div>
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ / ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
    <div class="flex flex-col gap-3 mt-6">
      
      <button type="button" class="btn-cancel w-full h-14 flex items-center justify-center gap-2"
              onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
      </button>
    </div>
  </form>

</div>
<script src="/js/calendar_booking.js"></script>

</body>
</html>