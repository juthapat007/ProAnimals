
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เพิ่มข้อมูลสัตว์เลี้ยง | ไชยปราการสัตวแพทย์</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css" />
</head>

<body>

  <div class="container">
    <div class="header">
      <h1><i class="fas fa-paw"></i> เพิ่มข้อมูลสัตว์เลี้ยง</h1>
    </div>
    
    <form id="petForm" class="pet-form" action="/users/insert_pet" method="post" enctype="multipart/form-data" novalidate>
      <div class="form-group">
        <label for="pet_name">ชื่อสัตว์เลี้ยง <span class="required" style="color: red;">*</span></label>
        <input type="text" name="pet_name" placeholder="กรุณากรอกชื่อสัตว์เลี้ยง" required><div class="error-message"></div>
      </div>
      
      <div class="form-group">
        <label for="pet_gender">เพศ <span class="required" style="color: red;">*</span></label>
        <select name="pet_gender" required>
          <option value="">-- เลือกเพศ --</option>
          <option value="ผู้">ผู้</option>
          <option value="เมีย">เมีย</option>
        </select>
        <div class="error-message"></div>
      </div>
      
<div class="form-group">
  <label for="pet_type">ประเภทสัตว์เลี้ยง <span class="required" style="color: red;">*</span></label>
  <select name="type_id" required>
  <option value="">-- เลือกประเภทสัตว์ --</option>
  <% pet_types.forEach(pt => { %>
    <option value="<%= pt.type_id %>"><%= pt.type %></option>
  <% }) %>
</select>

  <div class="error-message"></div>
</div>
      <div class="form-group">
        <label for="pet_img">รูปสัตว์เลี้ยง <span class="required" style="color: red;">*</span></label>
        <div class="file-upload">
          <div class="file-upload-btn">
            
            <span id="file-name"><i class="fas fa-cloud-upload-alt"></i>เลือกไฟล์ภาพ (JPG, PNG, GIF)</span>
          </div>
          <input type="file" name="pet_img" id="pet_img" accept="image/jpeg,image/png,image/gif" required>
        </div>
      </div>
       <center><img id="preview-img" src="" alt="Preview" style="display: none; margin-top:10px; max-width: 300px; border-radius: 8px;"/></center>
  <div class="error-message" id="file-error"></div>

  <small class="file-info">ขนาดไฟล์ไม่เกิน 2MB</small>
  
  <button type="submit" class="btn-submit">
        <i class="fas fa-save"></i> บันทึกข้อมูล
      </button>
      <button type="button" class="button btn-back" onclick="history.back()">
        <i class="fas fa-arrow-left"></i> ย้อนกลับ
      </button>
</div>

    </form>
  </div>

  <script>
    // แสดงชื่อไฟล์เมื่อผู้ใช้เลือกไฟล์
    document.getElementById('pet_img').addEventListener('change', function(e) {
      const fileName = e.target.files[0] ? e.target.files[0].name : 'เลือกไฟล์ภาพ (JPG, PNG, GIF)';
      document.getElementById('file-name').textContent = fileName;
      
      // ซ่อนข้อความ error เมื่อเลือกไฟล์แล้ว
      if(e.target.files.length > 0) {
        document.getElementById('file-error').style.display = 'none';
      }
    });
    
    // ตรวจสอบฟอร์มก่อนส่ง
    document.getElementById('pet_img').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const fileName = file ? file.name : 'เลือกไฟล์ภาพ (JPG, PNG, GIF)';
  document.getElementById('file-name').textContent = fileName;
  
  // preview ภาพ
  const previewImg = document.getElementById('preview-img');
  
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      previewImg.src = event.target.result;
      previewImg.style.display = 'block';
    }
    reader.readAsDataURL(file);
    
    document.getElementById('file-error').style.display = 'none';
  } else {
    previewImg.style.display = 'none';
  }
});

    document.getElementById('petForm').addEventListener('submit', function(e) {
      let isValid = true;
      
      // ตรวจสอบฟิลด์ข้อความ
      const textInputs = document.querySelectorAll('input[type="text"][required]');
      textInputs.forEach(input => {
        if(!input.value.trim()) {
          input.nextElementSibling.style.display = 'block';
          isValid = false;
        }
      });
      
      // ตรวจสอบ dropdown
      const selects = document.querySelectorAll('select[required]');
      selects.forEach(select => {
        if(!select.value) {
          select.nextElementSibling.style.display = 'block';
          isValid = false;
        }
      });
      
      // ตรวจสอบไฟล์
      const fileInput = document.getElementById('pet_img');
      if(fileInput.files.length === 0) {
        document.getElementById('file-error').style.display = 'block';
        isValid = false;
      }
      
      // หยุดการส่งฟอร์มถ้ามีข้อมูลไม่ครบ
      if(!isValid) {
        e.preventDefault();
        
        // เลื่อนไปยังฟิลด์แรกที่ผิดพลาด
        const firstError = document.querySelector('.error-message[style="display: block;"]') || 
                          document.querySelector('.error-message');
        if(firstError) {
          firstError.previousElementSibling.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
          });
          
          // ให้โฟกัสที่ฟิลด์นั้น
          if(firstError.previousElementSibling.tagName === 'INPUT' || 
             firstError.previousElementSibling.tagName === 'SELECT') {
            firstError.previousElementSibling.focus();
          }
        }
        
        // แสดง alert เพิ่มเติม
        alert('กรุณากรอกข้อมูลให้ครบถ้วนก่อนบันทึก');
      }
    });
    
    // ซ่อนข้อความ error เมื่อผู้ใช้เริ่มกรอกข้อมูล
    document.querySelectorAll('input, select').forEach(element => {
      element.addEventListener('input', function() {
        if(this.value) {
          const errorMsg = this.nextElementSibling;
          if(errorMsg && errorMsg.classList.contains('error-message')) {
            errorMsg.style.display = 'none';
          }
        }
      });
    });
  </script>
</body>
</html>