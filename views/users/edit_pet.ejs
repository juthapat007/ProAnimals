<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>แก้ไขข้อมูลสัตว์เลี้ยง | ไชยปราการสัตวแพทย์</title>
  <%- include('../partials/link') %>
</head>
<body >

<div class="container max-w-2xl bg-white rounded-2xl shadow-lg p-6 ">
  <%- include('../partials/header') %>

  <!-- Title -->
  
  <h3 class="text-2xl font-semibold text-text flex items-center gap-2 mb-8">
    <i class="fas fa-paw"></i> <strong >แก้ไขข้อมูลสัตว์เลี้ยง</strong>
  </h3>

  <!-- Form -->
  <form class="flex flex-col md:flex-row gap-8" action="/users/edit_pet" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="pet_id" value="<%= pet.pet_id %>">

    <!-- Image Upload -->
<!-- Image Upload -->
<div class="flex-shrink-0 relative w-40 h-40 md:w-48 md:h-48 mx-auto">
  <!-- รูปสัตว์เลี้ยง -->
  <img src="/uploads/<%= pet.img %>" alt="รูปสัตว์เลี้ยง" 
       class=" h-full object-cover form-input" id="previewImage" />

  <!-- ปุ่มกล้อง -->
  <label for="profile_img" class="absolute bottom-2 right-2 text-white p-2 rounded-full cursor-pointer shadow-md hover:bg-secondary transition" style="background-color: #FF9AA2;">
    <i class="fas fa-camera"></i>
  </label>

  <!-- input ไฟล์จริงซ่อน -->
  <input type="file" name="pet_img" id="profile_img" accept="image/*" onchange="previewSelectedImage(this)" class="hidden">
</div>


    <!-- Pet Info -->
    <div class="flex-1 flex flex-col ">
      <!-- Name -->
      <div >
        <strong for="pet_name">ชื่อ</strong>
        <input class=" form-input w-full" type="text" name="pet_name" id="pet_name" value="<%= pet.pet_name %>" required >
      </div><br>

      <!-- Gender -->
      <div>
        <strong for="pet_gender">เพศ</strong>
        <select name="pet_gender" id="pet_gender" required class="form-input">
          <option value="ผู้" <%= pet.pet_gender === 'ผู้' ? 'selected' : '' %>>ผู้</option>
          <option value="เมีย" <%= pet.pet_gender === 'เมีย' ? 'selected' : '' %>>เมีย</option>
        </select>
      </div><br>

      <!-- Pet Type -->
      <div >
        <strong for="type_id">ประเภทสัตว์</strong>
        <select name="type_id" id="type_id" required class="form-input">
          <% pet_types.forEach(pt => { %>
            <option value="<%= pt.type_id %>" <%= pt.type_id == pet.type_id ? 'selected' : '' %>><%= pt.type %></option>
          <% }) %>
        </select>
      </div><br>

      <!-- Buttons -->
      <div class="flex justify-between mt-6 gap-4">
 <button type="button"
 class="w-1/2 py-3 btn btn-cancel font-medium rounded-xl 
               hover:bg-gray-300 transition"
               onclick="history.back()">
  ยกเลิก
</button>

  <button type="submit" 
          class="btn btn-primary w-1/2 py-3">
    <i class="fas fa-save mr-2"></i> บันทึก
  </button>
</div>

    </div>
  </form>
</div>

  <script>
  function previewSelectedImage(input) {
    const file = input.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('previewImage').src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
  }
    function toggleDropdown() {
    const dropdown = document.getElementById('dropdownMenu');
    dropdown.classList.toggle('show');
  }
  window.addEventListener('click', function(e) {
    const menu = document.querySelector('.menu');
    if (!menu.contains(e.target)) {
      document.getElementById('dropdownMenu').classList.remove('show');
    }
  });
    document.getElementById('pet_img').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        document.getElementById('previewImage').src = event.target.result;
      }
      reader.readAsDataURL(file);
    }
  });
  </script>
</body>
</html>
